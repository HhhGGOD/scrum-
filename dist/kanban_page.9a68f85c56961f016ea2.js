"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[936],{5669:function(e,a,n){n.r(a),n.d(a,{default:function(){return I}});var s=n(7004),t=n(5019),r=n(4113),i=n(1577),l=n(8593),d=n(743),c=n(9655),o=n(9250),p=n(7903),k=n(3481),m=n(3798),_=n(7294),h=n(8962),u=n(5893),x=function(){const e=(0,d.I0)(),[a]=(0,c.lr)(),[n]=s.Z.useForm(),k=a.get("epic"),x=(0,o.UO)(),b=(0,d.v9)(m.iI)||[],y=x.id,{task_optiosn:j,users_options:f}=(0,h.Z)();(0,_.useEffect)((()=>{k&&n.setFieldValue("epic",k)}),[]);const v=b.map((e=>({value:e,label:e})));return(0,u.jsxs)(s.Z,{layout:"inline",form:n,children:[(0,u.jsx)(s.Z.Item,{name:"name",style:{width:200},children:(0,u.jsx)(t.Z,{placeholder:"任务名",className:"search_form_input"})}),(0,u.jsx)(s.Z.Item,{label:"负责人",name:"owner",style:{width:200},children:(0,u.jsx)(r.Z,{className:"search_wrap_select",options:f})}),(0,u.jsx)(s.Z.Item,{label:"任务类型",name:"type",style:{width:200},children:(0,u.jsx)(r.Z,{className:"search_wrap_select",options:j})}),(0,u.jsx)(s.Z.Item,{label:"epic",name:"epic",style:{width:200},children:(0,u.jsx)(r.Z,{className:"search_wrap_select",options:v})}),(0,u.jsx)(i.ZP,{onClick:function(){n.resetFields()},type:"",children:"重置"}),(0,u.jsx)(i.ZP,{onClick:async function(){const a=await n.validateFields();a&&await async function(a){let n=(await l.Z.get(`/api/project/${y}`)).data.data.kanban.map((e=>{let n=e.task;return n=n.filter((e=>{let n=!0,s=!0,t=!0,r=!0;return a.name&&e.name.indexOf(a.name)<0&&(n=!1),a.owner&&e.owner!==a.owner&&(t=!1),a.type&&e.type!==a.type&&(s=!1),a.epic&&e.epic!==a.epic&&(r=!1),n&&s&&t&&r})),{...e,task:n}}));e((0,p.rK)(n))}(a)},type:"primary",children:"查询"})]})},b=n(7009),y=n(4184),j=n.n(y),f=function(e){const a=e.task,n=a.task,s=(0,d.I0)();return(0,u.jsx)(b.bK,{droppableId:a.kanban_key,type:"task",children:(e,t)=>(0,u.jsxs)("div",{className:"task_drop_wrap",ref:e.innerRef,...e.droppableProps,children:[n.map(((e,n)=>(0,u.jsx)(b._l,{draggableId:`${a.kanban_key}_${e.name}`,index:n,children:(n,t)=>(0,u.jsx)("div",{className:"task_drag_wrap",ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,onClick:()=>{var n,t;n=a.kanban_key,t=e.task_id,s((0,m.mx)({show:!0,kanban_key:n,task_id:t,type:"edit"}))},children:(0,u.jsxs)("div",{className:"task_card",children:[(0,u.jsxs)("div",{className:"task_card_top",children:[(0,u.jsx)("div",{className:"task_head_picture",alt:""}),(0,u.jsx)("p",{className:"task_head-p",children:e.name})]}),(0,u.jsxs)("div",{className:"task_card_bottom",children:[(0,u.jsx)("div",{className:"task_owner",children:e.owner}),(0,u.jsx)("div",{className:j()({new_task_type:!0,red:"bug"===e.type,blue:"task"===e.type}),children:(0,u.jsx)("span",{className:"task_type-span",children:e.type})})]})]})})},`${a.kanban_key}_${e.name}`))),e.placeholder]})})};function v(e){const a=(0,d.I0)(),n=(0,d.v9)(p.sc);return console.log("看板 drop render"),(0,u.jsxs)(b.Z5,{onDragEnd:function(e){e.destination&&("kanban"===e.type&&(a((0,p.cY)({source:e.source.index,destination:e.destination.index})),a((0,p.Sr)())),"task"===e.type&&(e.source.droppableId===e.destination.droppableId?(a((0,p.yk)({kanban_key:e.destination.droppableId,source:e.source.index,destination:e.destination.index})),a((0,p.Sr)())):(a((0,p.h7)({source_kanban_key:e.source.droppableId,destination_kanban_key:e.destination.droppableId,source:e.source.index,destination:e.destination.index})),a((0,p.Sr)()))))},className:"drag_container",children:[(0,u.jsx)(b.bK,{direction:"horizontal",droppableId:"droppable-kanban",type:"kanban",children:(e,s)=>(0,u.jsxs)("div",{className:"kanban_drop_wrap",ref:e.innerRef,...e.droppableProps,children:[n.map(((e,n)=>(0,u.jsx)(b._l,{draggableId:e.kanban_key,index:n,children:(n,s)=>(0,u.jsxs)("div",{className:"kanban_drag_wrap",ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,children:[(0,u.jsx)("h1",{children:e.kanban_key}),(0,u.jsx)(f,{task:e}),(0,u.jsx)(i.ZP,{className:"new_task_btn",onClick:()=>{var n;n=e.kanban_key,a((0,m.mx)({show:!0,kanban_key:n,type:"create"}))},type:"primary",ghost:!0,children:"新建task"})]})},e.kanban_key))),e.placeholder]})}),(0,u.jsx)("div",{className:"kanban_drag_wrap",children:(0,u.jsx)(t.Z,{onPressEnter:function(e){const n=e.target.value.trim();n&&(a((0,p.Wx)({kanban_key:n})),a((0,p.Sr)()))},placeholder:"新建看板名称"})})]})}var w=_.memo(v),Z=n(9275),g=function(){const e=(0,d.I0)(),{kanban_key:a,type:n,task_id:i}=(0,d.v9)(m.Iv),l=(0,d.v9)(m.iI)||[],c=(0,d.v9)(m.Yd),o=(0,d.v9)(p.sc),h=(0,d.v9)(k.VP),x=(0,d.v9)(k.RW),[b]=s.Z.useForm();(0,_.useEffect)((()=>{if("edit"===n&&c){const e=o.find((e=>e.kanban_key===a)).task.find((e=>e.task_id===i));b.setFieldsValue(e)}"create"===n&&c&&b.resetFields()}),[c]);const y=l.map((e=>({value:e,label:e})));return(0,u.jsx)(Z.Z,{title:"create"===n?"创建任务":"编辑任务",open:c,okText:"create"===n?"创建任务":"修改",onOk:async function(){const s=await b.validateFields();s&&("create"===n&&(s.task_id=Math.random().toString(32).substring(2),e((0,p.tM)({kanban_key:a,task:s})),e((0,p.Sr)())),"edit"===n&&(e((0,p.gZ)({task:s,task_id:i,kanban_key:a})),e((0,p.Sr)())),e((0,m.mx)({show:!1})))},onCancel:function(){e((0,m.mx)({show:!1}))},children:(0,u.jsxs)(s.Z,{name:"basic",autoComplete:"off",form:b,children:[(0,u.jsx)(s.Z.Item,{label:"任务名称",name:"name",rules:[{required:!0,message:"请输入任务名称"}],children:(0,u.jsx)(t.Z,{})}),(0,u.jsx)(s.Z.Item,{label:"任务类型",name:"type",rules:[{required:!0,message:"请选择任务类型"}],children:(0,u.jsx)(r.Z,{children:(j=x,j.map((e=>(0,u.jsx)(r.Z.Option,{value:e.type,children:e.name},e.type))))})}),(0,u.jsx)(s.Z.Item,{label:"负责人",name:"owner",rules:[{required:!0,message:"请选择负责人"}],children:(0,u.jsx)(r.Z,{children:function(e){return e.map((e=>(0,u.jsx)(r.Z.Option,{value:e.username,children:e.username},e.username)))}(h)})}),(0,u.jsx)(s.Z.Item,{label:"epic",name:"epic",children:(0,u.jsx)(r.Z,{className:"search_wrap_select",options:y})})]})});var j},I=function(){const e=(0,d.I0)(),a=(0,o.UO)(),n=a.id,s=(0,d.v9)(m.kG),[t]=(0,c.lr)(),r=t.get("epic");return(0,_.useEffect)((()=>{e((0,k.iE)(n)).then((a=>{const n=a.payload;if(r){const a={epic:r};let s=n.map((e=>{let n=e.task;return n=n.filter((e=>{let n=!0,s=!0,t=!0,r=!0;return a.name&&e.name.indexOf(a.name)<0&&(n=!1),a.owner&&e.owner!==a.owner&&(t=!1),a.type&&e.type!==a.type&&(s=!1),a.epic&&e.epic!==a.epic&&(r=!1),n&&s&&t&&r})),{...e,task:n}}));e((0,p.rK)(s))}})),e((0,p.Wv)(n))}),[a.id]),(0,u.jsxs)("div",{className:"kanban_body",children:[(0,u.jsx)("div",{className:"Kanban_title",children:(0,u.jsxs)("h1",{children:[s.name,"-研发看板"]})}),(0,u.jsx)("div",{className:"kanban_search_wrap",children:(0,u.jsx)(x,{})}),(0,u.jsx)("div",{className:"drop_wrap",children:(0,u.jsx)(w,{})}),(0,u.jsx)(g,{})]})}}}]);